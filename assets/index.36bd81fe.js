import{V as Ue,f as be}from"./index.0e180887.js";import{_ as Me}from"./index.vue_vue_type_script_setup_true_lang.666c15f8.js";import{f as Ae,a as Ve,b as Se}from"./part.601bb279.js";import{P as Pe}from"./interface.7e30e7ed.js";import{f as Ie}from"./technologyType.24d5b042.js";import{B as Te,r as m,D as I,R as Y,S as Le,w as $e,F as Re,E as T,y as ze,d as f,o,c as g,j as d,e as t,f as u,k as y,n as v,g as Z,J as L,K as $,I as E,p as s,z as k,s as He,t as Ne,_ as je}from"./index.8b4e0df5.js";const We=A=>(He("data-v-98f39a4c"),A=A(),Ne(),A),Je={class:"app-container"},Ge={class:"drawingBox"},Ke={class:"leftHandleBox"},Oe={key:0},qe={class:"tag-list"},Qe={class:"percentage-value"},Xe=We(()=>d("span",{class:"percentage-label"},"\u5DF2\u7F16\u8F91\u96F6\u4EF6\u5360\u6BD4",-1)),Ye={key:0,class:"pdfBox"},Ze={key:0,class:"handleMethods"},el={key:0,class:"handleBox"},ll={class:"files-contain"},ul={class:"file-box"},tl={class:"dialog-footer"},al={class:"dialog-footer"},nl=Te({__name:"index",setup(A){const h=m(!1),D=I({depId:""}),x=Y("part-review-store",[]),R=Y("part-review-store-current-handle",{});Le(async(l,e)=>(await T.confirm("\u662F\u5426\u79BB\u5F00\u5F53\u524D\u9875\u9762\uFF1F","Warning",{confirmButtonText:"\u662F",cancelButtonText:"\u5426",type:"warning"}).then(()=>{}),!0));const z=m(null),ee=()=>{z.value.click()},H=m(null),le=()=>{H.value.click()},ue=l=>{console.log(l);const e=l.target.files[0];C.name=e.name,C.size=e.size,C.type=e.type,C.lastModified=e.lastModified,N=e},te=l=>{console.log(l);const e=l.target.files[0];_.drawingUrl=e};let N=null;const C=I({name:"",size:"",type:"",lastModified:""}),j=m(null),ae=()=>{j.value.click()},U=m([]),S=[],ne=l=>{console.log(l);const e=l.target.files;for(let c=0;c<e.length;c++){const i=e[c];S.push(i),U.value.push({name:i.name,size:i.size,type:i.type,lastModified:i.lastModified})}},oe=l=>{const e=U.value.findIndex(c=>c.name===l);U.value.splice(e,1),S.splice(e,1)},F=m(!1),se=async()=>{try{const l=new FormData;l.append("projectCode",D.depId),l.append("projectName",D.depId),l.append("file",N),S.forEach(r=>{l.append("files",r)}),F.value=!0;const e=await Ve(l),{data:c,msg:i}=e;p.value=c==null?void 0:c.map(r=>({...r,isSave:!1})),x.value=p.value,n.value=p.value[0],E.success("\u96F6\u4EF6\u5BFC\u5165\u6210\u529F"),h.value=!1}finally{F.value=!1}},re=async()=>{F.value=!0;let l="";if(_.radio==="local"){const e=new FormData;e.append("file",_.drawingUrl),l=(await be(e)).data}await Se({id:n.value.id,drawingUrl:l}),E.success("\u96F6\u4EF6\u56FE\u7EB8\u66F4\u65B0\u6210\u529F"),b.value=!1,F.value=!1,n.value.drawingUrl=l},p=m([]),n=m(null);$e(n,l=>{console.log(l),R.value={...l}},{deep:!0});const de=async()=>{const l=await Ae({id:n.value.id,processMethod:n.value.processMethod,external:n.value.external}),{data:e,msg:c}=l;if(e===0){E.success("\u96F6\u4EF6\u4FDD\u5B58\u6210\u529F"),n.value.isSave=!0;return}E.error(c)},W=l=>{const e=p.value.findIndex(c=>c.code===n.value.code);if(l==="prev"){if(e===0){E.warning("\u5DF2\u7ECF\u662F\u7B2C\u4E00\u9879\u4E86");return}n.value=p.value[e-1],E.success("\u5207\u6362\u6210\u529F")}if(l==="next"){if(e===p.value.length-1){E.warning("\u5DF2\u7ECF\u662F\u6700\u540E\u4E00\u9879\u4E86");return}n.value=p.value[e+1],E.success("\u5207\u6362\u6210\u529F")}},ce=l=>{n.value.processMethod=l},ie=l=>{n.value=l},pe=()=>{if(n.value.external===0){n.value.external=1;return}n.value.external=0},b=m(!1),_=I({radio:"local",drawingUrl:""}),fe=()=>{b.value=!0},J=m([]),ve=()=>{Ie({processMethod:"",state:Pe.ALL}).then(l=>{console.log(l),J.value=l.data})};Re(()=>{ve(),_e()});const _e=()=>{var l,e;((l=x==null?void 0:x.value)==null?void 0:l.length)>0&&((e=x.value)==null?void 0:e.some(i=>!i.isSave))&&T.confirm("\u662F\u5426\u6062\u590D\u4E0A\u6B21\u7684\u64CD\u4F5C\uFF1F","Warning",{confirmButtonText:"\u6062\u590D",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{p.value=x.value,n.value=R.value})},me=()=>{var l;((l=p==null?void 0:p.value)==null?void 0:l.length)>0?T.confirm("\u5F53\u524D\u5B58\u5728\u5DF2\u5BFC\u5165\u7684\u96F6\u4EF6\u5217\u8868\uFF0C\u7EE7\u7EED\u64CD\u4F5C\u4F1A\u8986\u76D6\u5F53\u524D\u96F6\u4EF6\u5217\u8868\uFF0C\u662F\u5426\u7EE7\u7EED\uFF1F","Warning",{confirmButtonText:"\u7EE7\u7EED",cancelButtonText:"\u53D6\u6D88",type:"warning"}).then(()=>{h.value=!0}).catch(()=>{h.value=!1}):h.value=!0},Fe=ze(()=>{var e,c,i,r;if(((e=p.value)==null?void 0:e.length)===0)return 0;const l=(i=(c=p.value)==null?void 0:c.filter(M=>M.isSave))==null?void 0:i.length;return Math.round(l/((r=p.value)==null?void 0:r.length)*1e3)/10}),ge=l=>{var e;if(l.isSave)return"success";if(((e=n.value)==null?void 0:e.code)===l.code)return"warning"};return(l,e)=>{var q,Q,X;const c=f("UploadFilled"),i=f("el-icon"),r=f("el-button"),M=f("CircleClose"),B=f("el-tag"),P=f("CircleCheck"),ye=f("el-card"),Ee=f("el-timeline-item"),he=f("el-timeline"),Ce=f("el-progress"),ke=f("el-empty"),w=f("el-form-item"),xe=f("CircleCloseFilled"),G=f("el-form"),K=f("el-dialog"),O=f("el-radio"),Be=f("el-radio-group"),we=f("el-input");return o(),g("div",Je,[d("div",Ge,[d("div",Ke,[t(r,{type:"primary",onClick:me,style:{"margin-bottom":"20px"}},{default:u(()=>[s("\u5BFC\u5165\u56FE\u7EB8\xA0"),t(i,null,{default:u(()=>[t(c)]),_:1})]),_:1}),((q=p.value)==null?void 0:q.length)>0?(o(),g("div",Oe,[t(he,{style:{"max-height":"60vh",overflow:"auto"}},{default:u(()=>[(o(!0),g(L,null,$(p.value,(a,V)=>(o(),v(Ee,{key:a.code,timestamp:a.code+a.partName,placement:"top",type:ge(a)},{default:u(()=>[t(ye,{onClick:De=>ie(a),style:{cursor:"pointer"}},{default:u(()=>[d("div",qe,[d("span",null,[a.processMethod?(o(),v(B,{key:1,class:"ml-2",type:"success"},{default:u(()=>[s(k(a==null?void 0:a.processMethod)+" ",1),t(i,null,{default:u(()=>[t(P)]),_:1})]),_:2},1024)):(o(),v(B,{key:0,class:"ml-2",type:"danger"},{default:u(()=>[s("\u5904\u7406\u65B9\u6CD5 "),t(i,null,{default:u(()=>[t(M)]),_:1})]),_:1}))]),d("span",null,[a.external?(o(),v(B,{key:1,class:"ml-2",type:"success"},{default:u(()=>[s("\u5185\u90E8\u52A0\u5DE5 "),t(i,null,{default:u(()=>[t(P)]),_:1})]),_:1})):(o(),v(B,{key:0,class:"ml-2",type:"warning"},{default:u(()=>[s("\u5916\u534F\u52A0\u5DE5 "),t(i,null,{default:u(()=>[t(M)]),_:1})]),_:1}))]),d("span",null,[a.isSave?(o(),v(B,{key:0,class:"ml-2",type:"success"},{default:u(()=>[s("\u5DF2\u7F16\u8F91 "),t(i,null,{default:u(()=>[t(P)]),_:1})]),_:1})):(o(),v(B,{key:1,class:"ml-2",type:"danger"},{default:u(()=>[s("\u6682\u672A\u4FDD\u5B58 "),t(i,null,{default:u(()=>[t(M)]),_:1})]),_:1}))])])]),_:2},1032,["onClick"])]),_:2},1032,["timestamp","type"]))),128))]),_:1})])):y("",!0),(Q=p.value)!=null&&Q.length?(o(),v(Ce,{key:1,type:"circle",percentage:Z(Fe)},{default:u(({percentage:a})=>[d("span",Qe,k(a)+"%",1),Xe]),_:1},8,["percentage"])):y("",!0)]),n.value?(o(),g("div",Ye,[t(Z(Ue),{style:{height:"65vh"},"page-scale":"page-width",pdf:n.value.drawingUrl},null,8,["pdf"]),d("div",{class:"handlePartDrawingUrl",onClick:fe},[t(r,{class:"handleBtn",type:"warning"},{default:u(()=>[s(" \u4FEE\u6539\u56FE\u7EB8 ")]),_:1})]),d("div",{class:"handleExternal",onClick:pe},[n.value.external?(o(),v(r,{key:1,class:"handleBtn",type:"success"},{default:u(()=>[s(" \u5185\u90E8\u52A0\u5DE5 ")]),_:1})):(o(),v(r,{key:0,class:"handleBtn",type:"danger"},{default:u(()=>[s(" \u5916\u534F\u52A0\u5DE5 ")]),_:1}))]),n.value?(o(),g("div",Ze,[(o(!0),g(L,null,$(J.value,a=>(o(),v(r,{class:"handleBtn",type:n.value.processMethod===a.processMethod?"success":"danger",onClick:V=>ce(a.processMethod)},{default:u(()=>[s(k(a.processMethod),1)]),_:2},1032,["type","onClick"]))),256))])):y("",!0)])):(o(),v(ke,{key:1,description:"\u70B9\u51FB\u5DE6\u4FA7\u6309\u94AE\u5BFC\u5165\u56FE\u7EB8"}))]),d("div",null,[(X=p.value)!=null&&X.length?(o(),g("div",el,[n.value?(o(),v(r,{key:0,onClick:e[0]||(e[0]=a=>W("prev"))},{default:u(()=>[s("\u4E0A\u4E00\u9879")]),_:1})):y("",!0),n.value?(o(),v(r,{key:1,type:"primary",onClick:de},{default:u(()=>[s("\u66F4\u65B0\u5F53\u524D\u96F6\u4EF6")]),_:1})):y("",!0),n.value?(o(),v(r,{key:2,onClick:e[1]||(e[1]=a=>W("next"))},{default:u(()=>[s("\u4E0B\u4E00\u9879")]),_:1})):y("",!0)])):y("",!0)]),t(K,{title:"\u5BFC\u5165\u56FE\u7EB8",modelValue:h.value,"onUpdate:modelValue":e[4]||(e[4]=a=>h.value=a),width:"30%","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},{footer:u(()=>[d("div",tl,[t(r,{type:"primary",onClick:se,loading:F.value},{default:u(()=>[s("\u5BFC \u5165")]),_:1},8,["loading"]),t(r,{onClick:e[3]||(e[3]=a=>h.value=!1),disabled:F.value},{default:u(()=>[s("\u53D6 \u6D88")]),_:1},8,["disabled"])])]),default:u(()=>[t(G,{model:D,"label-width":"90px"},{default:u(()=>[t(w,{label:"\u9879\u76EE\u540D\u79F0"},{default:u(()=>[t(Me,{modelValue:D.depId,"onUpdate:modelValue":e[2]||(e[2]=a=>D.depId=a),style:{width:"240px"}},null,8,["modelValue"])]),_:1}),t(w,{label:"\u56FE\u7EB8"},{default:u(()=>[d("div",null,[t(r,{type:"primary",onClick:ee},{default:u(()=>[s(" \u9009\u62E9\u6587\u4EF6 ")]),_:1}),d("input",{ref_key:"excelRef",ref:z,style:{display:"none"},name:"file",accept:".xls,.xlsx",type:"file",onChange:ue},null,544)]),d("div",null," \xA0\xA0"+k(C==null?void 0:C.name),1)]),_:1}),t(w,{label:"\u96F6\u4EF6\u6587\u4EF6"},{default:u(()=>{var a;return[d("div",null,[t(r,{type:"warning",onClick:ae},{default:u(()=>[s(" \u9009\u62E9\u56FE\u7EB8\u6587\u4EF6 ")]),_:1}),d("input",{ref_key:"pdfRef",ref:j,style:{display:"none"},name:"file",multiple:"",accept:".pdf",type:"file",onChange:ne},null,544),s(" "+k(((a=U.value)==null?void 0:a.length)+"\u4E2A\u96F6\u4EF6\u6587\u4EF6"),1)]),d("div",ll,[(o(!0),g(L,null,$(U.value,V=>(o(),g("div",ul,[s(k(V.name)+"\xA0\xA0",1),t(i,{onClick:De=>oe(V.name),style:{cursor:"pointer"}},{default:u(()=>[t(xe)]),_:2},1032,["onClick"])]))),256))])]}),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),t(K,{title:"\u5BFC\u5165\u56FE\u7EB8",modelValue:b.value,"onUpdate:modelValue":e[9]||(e[9]=a=>b.value=a),width:"30%","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1},{footer:u(()=>[d("div",al,[t(r,{type:"primary",onClick:re,loading:F.value},{default:u(()=>[s("\u66F4 \u6539")]),_:1},8,["loading"]),t(r,{onClick:e[8]||(e[8]=a=>b.value=!1),disabled:F.value,loading:F.value},{default:u(()=>[s("\u53D6 \u6D88")]),_:1},8,["disabled","loading"])])]),default:u(()=>[t(G,{model:_,"label-width":"90px"},{default:u(()=>[t(w,{label:""},{default:u(()=>[t(Be,{modelValue:_.radio,"onUpdate:modelValue":e[5]||(e[5]=a=>_.radio=a),onChange:e[6]||(e[6]=a=>_.drawingUrl=void 0)},{default:u(()=>[t(O,{label:"local"},{default:u(()=>[s("\u672C\u5730\u6587\u4EF6")]),_:1}),t(O,{label:"network"},{default:u(()=>[s("\u7F51\u7EDC\u5730\u5740")]),_:1})]),_:1},8,["modelValue"])]),_:1}),_.radio==="local"?(o(),v(w,{key:0,label:"\u56FE\u7EB8"},{default:u(()=>{var a;return[d("div",null,[t(r,{type:"primary",onClick:le},{default:u(()=>[s(" \u9009\u62E9\u6587\u4EF6 ")]),_:1}),d("input",{ref_key:"drawingUrlRef",ref:H,style:{display:"none"},name:"file",accept:".pdf,.png",type:"file",onChange:te},null,544)]),d("div",null," \xA0\xA0"+k((a=_==null?void 0:_.drawingUrl)==null?void 0:a.name),1)]}),_:1})):y("",!0),_.radio==="network"?(o(),v(w,{key:1,label:"\u56FE\u7EB8\u5730\u5740"},{default:u(()=>[t(we,{modelValue:_.drawingUrl,"onUpdate:modelValue":e[7]||(e[7]=a=>_.drawingUrl=a),placeholder:"\u8BF7\u8F93\u5165\u7F51\u7EDC\u5730\u5740"},null,8,["modelValue"])]),_:1})):y("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});const pl=je(nl,[["__scopeId","data-v-98f39a4c"]]);export{pl as default};
